#!/bin/sh
set -v # ideally it'll be hard to miss the hardlinks being made below

# envvar DEBIAN_MIRROR
# The URL of the Debian mirror to get packages from.
export DEBIAN_MIRROR="http://ftp.us.debian.org/debian/"

ln config/hooks/normal/build-uqm-dependencies.chroot config/includes.chroot/usr/bin/build-uqm-dependencies.sh
ln config/hooks/normal/toolchain-ugly-hacks.chroot config/includes.chroot/usr/bin/toolchain-ugly-hacks.sh

lb config noauto \
	--archive-areas "main contrib non-free"\
	--apt-options "-y --force-yes"\
	--apt-recommends false\
	--distribution stretch\
	-k 586\
	--architecture i386\
	--mirror-bootstrap ${DEBIAN_MIRROR}\
	--mirror-chroot ${DEBIAN_MIRROR}\
	--mirror-binary ${DEBIAN_MIRROR}\
	--backports true\
	--bootappend-live "boot=live config hostname=uqm-crossbuilder username=fwiffo"\
	"${@}"
